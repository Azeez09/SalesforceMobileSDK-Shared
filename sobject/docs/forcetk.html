<!DOCTYPE html>

<html>
<head>
  <title>forcetk.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="force.html">
                force.js
              </a>
            
              
              <a class="source" href="forcebone.html">
                forcebone.js
              </a>
            
              
              <a class="source" href="forcetk.html">
                forcetk.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>forcetk.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*
 * Copyright (c) 2011, salesforce.com, inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided
 * that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the
 * following disclaimer.
 *
 * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
 * the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * Neither the name of salesforce.com, inc. nor the names of its contributors may be used to endorse or
 * promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
 * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
 * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */</span>

<span class="comment">/* JavaScript library to wrap REST API on Visualforce. Leverages Ajax Proxy
 * (see http://bit.ly/sforce_ajax_proxy for details).
 *
 * Note that you must add the REST endpoint hostname for your instance (i.e. 
 * https://na1.salesforce.com/ or similar) as a remote site - in the admin
 * console, go to Your Name | Setup | Security Controls | Remote Site Settings
 */</span>

<span class="keyword">var</span> forcetk = window.forcetk;

<span class="keyword">if</span> (forcetk === <span class="literal">undefined</span>) {
    forcetk = {};
}

<span class="keyword">if</span> (forcetk.Client === <span class="literal">undefined</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>We use $j rather than $ for jQuery so it works in Visualforce</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> (window.$j === <span class="literal">undefined</span>) {
        $j = $;
    }

    <span class="comment">/**
     * The Client provides a convenient wrapper for the Force.com REST API, 
     * allowing JavaScript in Visualforce pages to use the API via the Ajax
     * Proxy.
     * @param [clientId=null] 'Consumer Key' in the Remote Access app settings
     * @param [loginUrl='https://login.salesforce.com/'] Login endpoint
     * @param [proxyUrl=null] Proxy URL. Omit if running on Visualforce or 
     *                  Cordova etc
     * @constructor
     */</span>
    forcetk.Client = <span class="keyword">function</span>(clientId, loginUrl, proxyUrl) {
        <span class="keyword">this</span>.clientId = clientId;
        <span class="keyword">this</span>.loginUrl = loginUrl || <span class="string">'https://login.salesforce.com/'</span>;
        <span class="keyword">if</span> (<span class="keyword">typeof</span> proxyUrl === <span class="string">'undefined'</span> || proxyUrl === <span class="literal">null</span>) {
            <span class="keyword">if</span> (location.protocol === <span class="string">'file:'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>In Cordova</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">this</span>.proxyUrl = <span class="literal">null</span>;
            } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>In Visualforce</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">this</span>.proxyUrl = location.protocol + <span class="string">"//"</span> + location.hostname
                    + <span class="string">"/services/proxy"</span>;
            }
            <span class="keyword">this</span>.authzHeader = <span class="string">"Authorization"</span>;
        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>On a server outside VF</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">this</span>.proxyUrl = proxyUrl;
            <span class="keyword">this</span>.authzHeader = <span class="string">"X-Authorization"</span>;
        }
        <span class="keyword">this</span>.refreshToken = <span class="literal">null</span>;
        <span class="keyword">this</span>.sessionId = <span class="literal">null</span>;
        <span class="keyword">this</span>.apiVersion = <span class="literal">null</span>;
        <span class="keyword">this</span>.instanceUrl = <span class="literal">null</span>;
        <span class="keyword">this</span>.asyncAjax = <span class="literal">true</span>;
        <span class="keyword">this</span>.userAgentString = <span class="literal">null</span>;
    }

    <span class="comment">/**
    * Set a User-Agent to use in the client.
    * @param uaString A User-Agent string to use for all requests.
    */</span>
    forcetk.Client.prototype.setUserAgentString = <span class="keyword">function</span>(uaString) {
        <span class="keyword">this</span>.userAgentString = uaString;
    }

    <span class="comment">/**
     * Set a refresh token in the client.
     * @param refreshToken an OAuth refresh token
     */</span>
    forcetk.Client.prototype.setRefreshToken = <span class="keyword">function</span>(refreshToken) {
        <span class="keyword">this</span>.refreshToken = refreshToken;
    }

    <span class="comment">/**
     * Refresh the access token.
     * @param callback function to call on success
     * @param error function to call on failure
     */</span>
    forcetk.Client.prototype.refreshAccessToken = <span class="keyword">function</span>(callback, error) {
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
        <span class="keyword">var</span> url = <span class="keyword">this</span>.loginUrl + <span class="string">'/services/oauth2/token'</span>;
        <span class="keyword">return</span> $j.ajax({
            type: <span class="string">'POST'</span>,
            url: (<span class="keyword">this</span>.proxyUrl !== <span class="literal">null</span>) ? <span class="keyword">this</span>.proxyUrl: url,
            cache: <span class="literal">false</span>,
            processData: <span class="literal">false</span>,
            data: <span class="string">'grant_type=refresh_token&amp;client_id='</span> + <span class="keyword">this</span>.clientId + <span class="string">'&amp;refresh_token='</span> + <span class="keyword">this</span>.refreshToken,
            success: callback,
            error: error,
            dataType: <span class="string">"json"</span>,
            beforeSend: <span class="keyword">function</span>(xhr) {
                <span class="keyword">if</span> (that.proxyUrl !== <span class="literal">null</span>) {
                    xhr.setRequestHeader(<span class="string">'SalesforceProxy-Endpoint'</span>, url);
                }
            }
        });
    }

    <span class="comment">/**
     * Set a session token and the associated metadata in the client.
     * @param sessionId a salesforce.com session ID. In a Visualforce page,
     *                   use '{!$Api.sessionId}' to obtain a session ID.
     * @param [apiVersion="21.0"] Force.com API version
     * @param [instanceUrl] Omit this if running on Visualforce; otherwise 
     *                   use the value from the OAuth token.
     */</span>
    forcetk.Client.prototype.setSessionToken = <span class="keyword">function</span>(sessionId, apiVersion, instanceUrl) {
        <span class="keyword">this</span>.sessionId = sessionId;
        <span class="keyword">this</span>.apiVersion = (<span class="keyword">typeof</span> apiVersion === <span class="string">'undefined'</span> || apiVersion === <span class="literal">null</span>)
        ? <span class="string">'v24.0'</span>: apiVersion;
        <span class="keyword">if</span> (<span class="keyword">typeof</span> instanceUrl === <span class="string">'undefined'</span> || instanceUrl == <span class="literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>location.hostname can be of the form &#39;abc.na1.visual.force.com&#39;,
&#39;na1.salesforce.com&#39; or &#39;abc.my.salesforce.com&#39; (custom domains). 
Split on &#39;.&#39;, and take the [1] or [0] element as appropriate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">var</span> elements = location.hostname.split(<span class="string">"."</span>);            
            <span class="keyword">var</span> instance = <span class="literal">null</span>;
            <span class="keyword">if</span>(elements.length == <span class="number">4</span> &amp;&amp; elements[<span class="number">1</span>] === <span class="string">'my'</span>) {
                instance = elements[<span class="number">0</span>] + <span class="string">'.'</span> + elements[<span class="number">1</span>];
            } <span class="keyword">else</span> <span class="keyword">if</span>(elements.length == <span class="number">3</span>){
                instance = elements[<span class="number">0</span>];
            } <span class="keyword">else</span> {
                instance = elements[<span class="number">1</span>];
            }
            <span class="keyword">this</span>.instanceUrl = <span class="string">"https://"</span> + instance + <span class="string">".salesforce.com"</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">this</span>.instanceUrl = instanceUrl;
        }
    }

    <span class="comment">/*
     * Low level utility function to call the Salesforce endpoint.
     * @param path resource path relative to /services/data
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     * @param [method="GET"] HTTP method for call
     * @param [payload=null] payload for POST/PATCH etc
     */</span>
    forcetk.Client.prototype.ajax = <span class="keyword">function</span>(path, callback, error, method, payload, retry) {
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
        <span class="keyword">var</span> url = <span class="keyword">this</span>.instanceUrl + <span class="string">'/services/data'</span> + path;
        <span class="keyword">return</span> $j.ajax({
            type: method || <span class="string">"GET"</span>,
            async: <span class="keyword">this</span>.asyncAjax,
            url: (<span class="keyword">this</span>.proxyUrl !== <span class="literal">null</span>) ? <span class="keyword">this</span>.proxyUrl: url,
            contentType: <span class="string">'application/json'</span>,
            cache: <span class="literal">false</span>,
            processData: <span class="literal">false</span>,
            data: payload,
            success: callback,
            error: (!<span class="keyword">this</span>.refreshToken || retry ) ? error : <span class="keyword">function</span>(jqXHR, textStatus, errorThrown) {
                <span class="keyword">if</span> (jqXHR.status === <span class="number">401</span>) {
                    that.refreshAccessToken(<span class="keyword">function</span>(oauthResponse) {
                        that.setSessionToken(oauthResponse.access_token, <span class="literal">null</span>,
                        oauthResponse.instance_url);
                        that.ajax(path, callback, error, method, payload, <span class="literal">true</span>);
                    }, error);
                } <span class="keyword">else</span> {
                    error(jqXHR, textStatus, errorThrown);
                }
            },
            dataType: <span class="string">"json"</span>,
            beforeSend: <span class="keyword">function</span>(xhr) {
                <span class="keyword">if</span> (that.proxyUrl !== <span class="literal">null</span>) {
                    xhr.setRequestHeader(<span class="string">'SalesforceProxy-Endpoint'</span>, url);
                }
                xhr.setRequestHeader(that.authzHeader, <span class="string">"Bearer "</span> + that.sessionId);
                xhr.setRequestHeader(<span class="string">'X-User-Agent'</span>, <span class="string">'salesforce-toolkit-rest-javascript/'</span> + that.apiVersion);
                <span class="keyword">if</span> (that.userAgentString !== <span class="literal">null</span>) {
                    xhr.setRequestHeader(<span class="string">'User-Agent'</span>, that.userAgentString);
                }
            }
        });
    }

    <span class="comment">/**
     * Utility function to query the Chatter API and download a file
     * Note, raw XMLHttpRequest because JQuery mangles the arraybuffer
     * This should work on any browser that supports XMLHttpRequest 2 because arraybuffer is required. 
     * For mobile, that means iOS &gt;= 5 and Android &gt;= Honeycomb
     * @author Tom Gersic
     * @param path resource path relative to /services/data
     * @param mimetype of the file
     * @param callback function to which response will be passed
     * @param [error=null] function to which request will be passed in case of error
     * @param rety true if we've already tried refresh token flow once
     **/</span>
    forcetk.Client.prototype.getChatterFile = <span class="keyword">function</span>(path,mimeType,callback,error,retry) {
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
        <span class="keyword">var</span> url = <span class="keyword">this</span>.instanceUrl + path;
        <span class="keyword">var</span> request = <span class="keyword">new</span> XMLHttpRequest();
        request.open(<span class="string">"GET"</span>,  (<span class="keyword">this</span>.proxyUrl !== <span class="literal">null</span>) ? <span class="keyword">this</span>.proxyUrl: url, <span class="literal">true</span>);
        request.responseType = <span class="string">"arraybuffer"</span>;
        request.setRequestHeader(that.authzHeader, <span class="string">"Bearer "</span> + that.sessionId);
        request.setRequestHeader(<span class="string">'X-User-Agent'</span>, <span class="string">'salesforce-toolkit-rest-javascript/'</span> + that.apiVersion);
        <span class="keyword">if</span> (that.userAgentString !== <span class="literal">null</span>) {
            xhr.setRequestHeader(<span class="string">'User-Agent'</span>, that.userAgentString);
        }
        <span class="keyword">if</span> (<span class="keyword">this</span>.proxyUrl !== <span class="literal">null</span>) {
            request.setRequestHeader(<span class="string">'SalesforceProxy-Endpoint'</span>, url);
        }
        request.onreadystatechange = <span class="keyword">function</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>continue if the process is completed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="keyword">if</span> (request.readyState == <span class="number">4</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>continue only if HTTP status is &quot;OK&quot;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">if</span> (request.status == <span class="number">200</span>) {
                    <span class="keyword">try</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>retrieve the response</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        callback(request.response);
                    } <span class="keyword">catch</span>(e) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>display error message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        alert(<span class="string">"Error reading the response: "</span> + e.toString());
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>refresh token in 401</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="keyword">else</span> <span class="keyword">if</span>(request.status == <span class="number">401</span> &amp;&amp; !retry) {
                    that.refreshAccessToken(<span class="keyword">function</span>(oauthResponse) {
                        that.setSessionToken(oauthResponse.access_token, <span class="literal">null</span>, oauthResponse.instance_url);
                        that.getChatterFile(path, mimeType, callback, error, <span class="literal">true</span>);
                    }, error);
                } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>display status message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    error(request,request.statusText,request.response);
                }
            }
        }
        request.send();
    }

    <span class="comment">/*
     * Low level utility function to call the Salesforce endpoint specific for Apex REST API.
     * @param path resource path relative to /services/apexrest
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     * @param [method="GET"] HTTP method for call
     * @param [payload=null] payload for POST/PATCH etc
	 * @param [paramMap={}] parameters to send as header values for POST/PATCH etc
	 * @param [retry] specifies whether to retry on error
     */</span>
    forcetk.Client.prototype.apexrest = <span class="keyword">function</span>(path, callback, error, method, payload, paramMap, retry) {
        <span class="keyword">var</span> that = <span class="keyword">this</span>;
        <span class="keyword">var</span> url = <span class="keyword">this</span>.instanceUrl + <span class="string">'/services/apexrest'</span> + path;
        <span class="keyword">return</span> $j.ajax({
            type: method || <span class="string">"GET"</span>,
            async: <span class="keyword">this</span>.asyncAjax,
            url: (<span class="keyword">this</span>.proxyUrl !== <span class="literal">null</span>) ? <span class="keyword">this</span>.proxyUrl: url,
            contentType: <span class="string">'application/json'</span>,
            cache: <span class="literal">false</span>,
            processData: <span class="literal">false</span>,
            data: payload,
            success: callback,
            error: (!<span class="keyword">this</span>.refreshToken || retry ) ? error : <span class="keyword">function</span>(jqXHR, textStatus, errorThrown) {
                <span class="keyword">if</span> (jqXHR.status === <span class="number">401</span>) {
                    that.refreshAccessToken(<span class="keyword">function</span>(oauthResponse) {
                        that.setSessionToken(oauthResponse.access_token, <span class="literal">null</span>,
                        oauthResponse.instance_url);
                        that.apexrest(path, callback, error, method, payload, paramMap, <span class="literal">true</span>);
                    },
                    error);
                } <span class="keyword">else</span> {
                    error(jqXHR, textStatus, errorThrown);
                }
            },
            dataType: <span class="string">"json"</span>,
            beforeSend: <span class="keyword">function</span>(xhr) {
                <span class="keyword">if</span> (that.proxyUrl !== <span class="literal">null</span>) {
                    xhr.setRequestHeader(<span class="string">'SalesforceProxy-Endpoint'</span>, url);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Add any custom headers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="keyword">if</span> (paramMap === <span class="literal">null</span>) {
					paramMap = {};
				}
				<span class="keyword">for</span> (paramName <span class="keyword">in</span> paramMap) {
					xhr.setRequestHeader(paramName, paramMap[paramName]);
				}
                xhr.setRequestHeader(that.authzHeader, <span class="string">"Bearer "</span> + that.sessionId);
                xhr.setRequestHeader(<span class="string">'X-User-Agent'</span>, <span class="string">'salesforce-toolkit-rest-javascript/'</span> + that.apiVersion);
                <span class="keyword">if</span> (that.userAgentString !== <span class="literal">null</span>) {
                    xhr.setRequestHeader(<span class="string">'User-Agent'</span>, that.userAgentString);
                }
            }
        });
    }

    <span class="comment">/*
     * Lists summary information about each Salesforce.com version currently 
     * available, including the version, label, and a link to each version's
     * root.
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.versions = <span class="keyword">function</span>(callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span>, callback, error);
    }

    <span class="comment">/*
     * Lists available resources for the client's API version, including 
     * resource name and URI.
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.resources = <span class="keyword">function</span>(callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/'</span>, callback, error);
    }

    <span class="comment">/*
     * Lists the available objects and their metadata for your organization's 
     * data.
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.describeGlobal = <span class="keyword">function</span>(callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span>, callback, error);
    }

    <span class="comment">/*
     * Describes the individual metadata for the specified object.
     * @param objtype object type; e.g. "Account"
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.metadata = <span class="keyword">function</span>(objtype, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span>
        , callback, error);
    }

    <span class="comment">/*
     * Completely describes the individual metadata at all levels for the 
     * specified object.
     * @param objtype object type; e.g. "Account"
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.describe = <span class="keyword">function</span>(objtype, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype
        + <span class="string">'/describe/'</span>, callback, error);
    }

    <span class="comment">/*
     * Creates a new record of the given type.
     * @param objtype object type; e.g. "Account"
     * @param fields an object containing initial field names and values for 
     *               the record, e.g. {:Name "salesforce.com", :TickerSymbol 
     *               "CRM"}
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.create = <span class="keyword">function</span>(objtype, fields, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span>
        , callback, error, <span class="string">"POST"</span>, JSON.stringify(fields));
    }

    <span class="comment">/*
     * Retrieves field values for a record of the given type.
     * @param objtype object type; e.g. "Account"
     * @param id the record's object ID
     * @param [fields=null] optional comma-separated list of fields for which 
     *               to return values; e.g. Name,Industry,TickerSymbol
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.retrieve = <span class="keyword">function</span>(objtype, id, fieldlist, callback, error) {
        <span class="keyword">if</span> (!arguments[<span class="number">4</span>]) {
            error = callback;
            callback = fieldlist;
            fieldlist = <span class="literal">null</span>;
        }
        <span class="keyword">var</span> fields = fieldlist ? <span class="string">'?fields='</span> + fieldlist : <span class="string">''</span>;
        <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span> + id
        + fields, callback, error);
    }

    <span class="comment">/*
     * Upsert - creates or updates record of the given type, based on the 
     * given external Id.
     * @param objtype object type; e.g. "Account"
     * @param externalIdField external ID field name; e.g. "accountMaster__c"
     * @param externalId the record's external ID value
     * @param fields an object containing field names and values for 
     *               the record, e.g. {:Name "salesforce.com", :TickerSymbol 
     *               "CRM"}
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.upsert = <span class="keyword">function</span>(objtype, externalIdField, externalId, fields, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span> + externalIdField + <span class="string">'/'</span> + externalId 
        + <span class="string">'?_HttpMethod=PATCH'</span>, callback, error, <span class="string">"POST"</span>, JSON.stringify(fields));
    }

    <span class="comment">/*
     * Updates field values on a record of the given type.
     * @param objtype object type; e.g. "Account"
     * @param id the record's object ID
     * @param fields an object containing initial field names and values for 
     *               the record, e.g. {:Name "salesforce.com", :TickerSymbol 
     *               "CRM"}
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.update = <span class="keyword">function</span>(objtype, id, fields, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span> + id 
        + <span class="string">'?_HttpMethod=PATCH'</span>, callback, error, <span class="string">"POST"</span>, JSON.stringify(fields));
    }

    <span class="comment">/*
     * Deletes a record of the given type. Unfortunately, 'delete' is a 
     * reserved word in JavaScript.
     * @param objtype object type; e.g. "Account"
     * @param id the record's object ID
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.del = <span class="keyword">function</span>(objtype, id, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/sobjects/'</span> + objtype + <span class="string">'/'</span> + id
        , callback, error, <span class="string">"DELETE"</span>);
    }

    <span class="comment">/*
     * Executes the specified SOQL query.
     * @param soql a string containing the query to execute - e.g. "SELECT Id, 
     *             Name from Account ORDER BY Name LIMIT 20"
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.query = <span class="keyword">function</span>(soql, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/query?q='</span> + escape(soql)
        , callback, error);
    }
    
    <span class="comment">/*
     * Queries the next set of records based on pagination.
     * &lt;p&gt;This should be used if performing a query that retrieves more than can be returned
     * in accordance with http://www.salesforce.com/us/developer/docs/api_rest/Content/dome_query.htm&lt;/p&gt;
     * &lt;p&gt;Ex: forcetkClient.queryMore( successResponse.nextRecordsUrl, successHandler, failureHandler )&lt;/p&gt;
     * 
     * @param url - the url retrieved from nextRecordsUrl or prevRecordsUrl
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.queryMore = <span class="keyword">function</span>( url, callback, error ){</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>-- ajax call adds on services/data to the url call, so only send the url after</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">var</span> serviceData = <span class="string">"services/data"</span>;
        <span class="keyword">var</span> index = url.indexOf( serviceData );
        <span class="keyword">if</span>( index &gt; -<span class="number">1</span> ){
        	url = url.substr( index + serviceData.length );
        } <span class="keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>-- leave alone</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        }
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax( url, callback, error );
    }

    <span class="comment">/*
     * Executes the specified SOSL search.
     * @param sosl a string containing the search to execute - e.g. "FIND 
     *             {needle}"
     * @param callback function to which response will be passed
     * @param [error=null] function to which jqXHR will be passed in case of error
     */</span>
    forcetk.Client.prototype.search = <span class="keyword">function</span>(sosl, callback, error) {
        <span class="keyword">return</span> <span class="keyword">this</span>.ajax(<span class="string">'/'</span> + <span class="keyword">this</span>.apiVersion + <span class="string">'/search?q='</span> + escape(sosl)
        , callback, error);
    }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
